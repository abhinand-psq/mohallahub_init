Cursor Build Summary:

## SECTION 1: PROJECT OVERVIEW & STATUS 



### 1.2 Development Status (Phase 1: Foundation Complete)
The core architectural setup and the entire database modeling for the initial PRD (Part 1) are complete. The system is ready for full-scale API development.

### 1.3 Architectural & Tech Stack Foundation
* **Runtime & Framework:** Node.js (ESM) + Express.js.
* **Architecture:** Modular MVC + Service Layer Pattern (ensuring separation of concerns).
* **Key Directories Setup:** Separate folders for 'models', 'routes', 'controllers', 'middleware', 'config', and 'utils'.
* **Core Dependencies Included:** mongoose, express, bcryptjs, jsonwebtoken, dotenv, express-validator, multer, cloudinary, morgan, winston.
* **Security:** JWT (Access + Refresh tokens) and bcryptjs for password hashing.
* **Configuration:** Dedicated configuration files for MongoDB (db.js) and Cloudinary (cloudinary.js) are prepared.

---

## SECTION 2: TECHNOLOGY STACK & CONFIGURATION

| Layer | Technology |
| :--- | :--- |
| Runtime | Node.js |
| Framework | Express.js |
| Database | MongoDB with Mongoose ODM |
| File Uploads | Multer + Cloudinary |
| Authentication | JWT (Access + Refresh) |
| Token Storage | MongoDB (Refresh Token collection) |
| Logging | Morgan + Winston |
| Password Hashing | bcryptjs |
| File Type | ESM ("type": "module") |

### 2.1 Environment Variables (Stored in .env)
The system relies on the following essential environment variables:
* PORT
* MONGO_URI
* JWT_SECRET (Access Token)
* JWT_REFRESH_SECRET (Refresh Token)
* CLOUDINARY_CLOUD_NAME, CLOUDINARY_API_KEY, CLOUDINARY_API_SECRET
* EMAIL_SMTP_USER, EMAIL_SMTP_PASS
* FRONTEND_URL

---

## SECTION 3: DATABASE DESIGN & CONSTRAINTS (Mongoose Schemas)

All 14 core schemas are defined, with critical indexing and relationships established.

### 3.1 Master Data & Access
* **Ward.js:** Stores geographic hierarchy (State â†’ Ward). **Index:** Unique combination of hierarchy levels; **GeoJSON index** for future location queries.
* **UserCommunityAccess.js:** Links users and communities to a specific ward hierarchy.

### 3.2 Core Entities
* **User.js:** User credentials, profile data, role, and address reference. **Unique Indexes:** email, username.
* **Community.js:** Hyperlocal communities. **Unique Index:** name + hierarchy combination.
* **CommunityMembership.js:** Defines membership and roles (`owner`, `admin`, `member`). **Unique Index:** user + community.

### 3.3 Content & Interaction
* **Post.js:** User-generated content (text/media, up to 3 items). Supports reposting (`rePostOf`). **Key Index:** (community, createdAt) for feed generation.
* **Comment.js:** Threaded comments, supports media replies, uses `isDeleted` for soft deletion.
* **Like.js:** Tracks post and comment likes. **Unique Index:** user + post/comment.
* **SavedPost.js:** Tracks saved posts.
* **Follow.js:** Tracks user-to-user relationships. **Unique Index:** follower + following.
* **Notification.js:** Alerts for user activities.
* **Report.js:** Handles reports against content/users.
* **(Placeholder) Analytics.js:** Future model for engagement tracking.

### 3.4 Authentication & Admin Models
* **RefreshToken.js:** Stores refresh tokens (one per device).
    * **CRITICAL CONSTRAINT:** Includes a **TTL (Time-To-Live) index** on the `expiresAt` field (`{ expireAfterSeconds: 0 }`) to ensure automatic, secure expiration and purging of tokens.
* **Admin.js:** Dedicated model for administrators (email, passwordHash, role). **Unique Index:** email.

---

## SECTION 4: CLOUDINARY INTEGRATION WORKFLOW

### 4.1 Implementation Strategy
Cloudinary is used for all media uploads (profile pics, post media), adhering to a strategy that separates storage from the application server.

### 4.2 Workflow
1.  **Client Request:** Frontend sends `multipart/form-data`.
2.  **Server Parsing:** Express route uses **`multer`** to process the file.
3.  **Upload:** File is sent to Cloudinary via the SDK (`cloudinary.uploader.upload()`).
4.  **Database Storage:** The DB stores only the Cloudinary response metadata (`secure_url`, `public_id`, `format`, etc.).

### 4.3 Thumbnails & Optimization
The system is designed to use Cloudinary's dynamic transformation URLs (e.g., `cloudinary.url(publicId, { width: 200, crop: "fill" })`) to generate thumbnail previews on demand, reducing the burden on the backend and improving load times.